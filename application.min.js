App.onLaunch=function(a){var b;return b=new Downloader(localStorage.getItem("putioAccessToken")),b.downloadList(null,function(a,b){var c;return c=createList(a,b),c.addEventListener("select",selectFile),c.addEventListener("play",selectFile),navigationDocument.pushDocument(c)})},App.onWillResignActive=function(){},App.onDidEnterBackground=function(){},App.onWillEnterForeground=function(){},App.onDidBecomeActive=function(){},App.onWillTerminate=function(){};var Downloader;Downloader=function(){function a(a){this.accessToken=a}return a.prototype.baseURL="https://api.put.io/v2",a.prototype.urlFor=function(a){var b;return b=a.indexOf("?")>-1?"&":"?",this.baseURL+a+b+"oauth_token="+this.accessToken},a.prototype.urlForList=function(a){var b;return b="/files/list",a&&(b+="?parent_id="+a),this.urlFor(b)},a.prototype.urlForMovie=function(a){return this.urlFor("/files/"+a+"/hls/media.m3u8?subtitle_key=all")},a.prototype.urlForSetStartFrom=function(a){return this.urlFor("/files/"+a+"/start-from/set")},a.prototype.download=function(a,b){var c,d;return d=this,c=new XMLHttpRequest,c.open("GET",a),c.responseType="json",c.onload=function(){var a,c,e;return c=JSON.parse(this.responseText),e=c.parent.name,a=c.files.map(function(a){return function(a){return new File(d,a)}}(this)),b(e,a.filter(function(a){return a.isUsable()}))},c.onerror=function(){return console.log(c)},c.send()},a.prototype.downloadList=function(a,b){return this.download(this.urlForList(a),b)},a.prototype.setStartFrom=function(a,b){var c,d;return d=this.urlForSetStartFrom(a),c=new XMLHttpRequest,c.open("POST",d),c.responseType="json",c.send("time="+b)},a}();var File;File=function(){function a(a,b){this.downloader=a,this.id=String(b.id),this.constructor.files[this.id]=this,this.name=b.name,this.icon=b.icon,this.screenshot=b.screenshot,this.startFrom=b.start_from,this.isPlayable=b.is_mp4_available||"video/mp4"===b.content_type,this.fileType=function(){switch(b.file_type){case 0:return"directory";case 3:return"movie";default:return"other"}}()}return a.files={},a.prototype.isUsable=function(){return"other"!==this.fileType},a.prototype.url=function(){return this.downloader.urlForMovie(this.id)},a.prototype.play=function(){var a,b;return b=new MediaItem("video",this.downloader.urlForMovie(this.id)),b.title=this.name,b.artworkImageURL=this.screenshot,b.resumeTime=this.startFrom,a=new Player,a.playlist=new Playlist,a.playlist.push(b),a.addEventListener("timeDidChange",function(a){return function(b){return a.updateStartFrom(b.time)}}(this),{interval:10}),a.play()},a.prototype.updateStartFrom=function(a){return this.startFrom=a,this.downloader.setStartFrom(this.id,a)},a}();var createAlert,createList,createListItem,escapeHTML,openDirectory,selectFile;createAlert=function(a,b){var c,d;return c="<?xml version='1.0' encoding='UTF-8' ?>\n<document>\n  <alertTemplate>\n    <title>"+escapeHTML(a)+"</title>\n    <description>"+escapeHTML(b)+"</description>\n  </alertTemplate>\n</document>",d=new DOMParser,d.parseFromString(c,"application/xml")},createList=function(a,b){var c,d,e,f;return e="<?xml version='1.0' encoding='UTF-8' ?>\n  <document>\n  <listTemplate>\n    <list>\n      <header>\n        <title>"+a+"</title>\n      </header>\n      <section>",d="      </section>\n    </list>\n  </listTemplate>\n</document>",c=b.map(function(a){return createListItem(a)}),f=new DOMParser,f.parseFromString(e+c.join("")+d,"application/xml")},createListItem=function(a){var b,c,d;return c="<listItemLockup id='"+a.id+"'>\n  <title>"+a.name+'</title>\n  <img src="'+a.icon+'" width="60" height="60" />',d="movie"===a.fileType?'<relatedContent>\n  <lockup>\n    <img src="'+a.screenshot+'" />\n    <description>'+a.name+"</description>\n  </lockup>\n</relatedContent>":'<decorationImage src="resource://chevron" />',b="</listItemLockup>",c+d+b},selectFile=function(a){var b,c;switch(c=a.target.getAttribute("id"),b=File.files[c],b.fileType){case"movie":return b.play();case"directory":return openDirectory(b)}},openDirectory=function(a){},escapeHTML=function(a){return String(a).replace(/[\"&<>]/g,function(a){return{'"':"&quot;","&":"&amp;","<":"&lt;",">":"&gt;"}[a]})};